/* 
   CATIA VBA Macro for Creating a Rectangular Reference Standard with 16 Holes
   Plate Thickness: 0.5 inches (12.7mm)
   
   Instructions:
   1. Open CATIA V5
   2. Go to Tools > Macro > Macros
   3. Select "ThisWorkbench.CATScript" and click "Edit"
   4. Copy and paste this code
   5. Run the macro
*/

Sub CATMain()
    Dim partDocument As Document
    Dim part As Part
    Dim hybridShapeFactory As HybridShapeFactory
    Dim hybridBodies As HybridBodies
    Dim hybridBody As HybridBody
    Dim sketches As Sketches
    Dim originElements As OriginElements
    Dim reference As Reference
    
    ' Create a new Part document
    Set partDocument = CATIA.Documents.Add("Part")
    Set part = partDocument.Part
    
    ' Access hybrid shape factory
    Set hybridShapeFactory = part.HybridShapeFactory
    
    ' Access the Part bodies collection
    Set hybridBodies = part.HybridBodies
    
    ' Create a new hybrid body for geometry construction
    Set hybridBody = hybridBodies.Add()
    hybridBody.Name = "Reference Standard"
    
    ' Access the sketches collection
    Set sketches = part.Sketches
    
    ' Access origin elements to get reference planes
    Set originElements = part.OriginElements
    
    ' Create reference for the XY plane
    Set reference = originElements.PlaneXY
    
    ' Create sketch for the base plate
    Dim basePlateSketch As Sketch
    Set basePlateSketch = sketches.Add(reference)
    
    ' Access the factory to create geometry
    Dim factory2D As Factory2D
    Set factory2D = basePlateSketch.OpenEdition()
    
    ' Define rectangular plate dimensions 
    Dim plateWidth As Double: plateWidth = 200  ' mm
    Dim plateLength As Double: plateLength = 300  ' mm
    
    ' Create base rectangle
    Dim rectangle As Line2D
    Set rectangle = factory2D.CreateLine(-plateWidth/2, -plateLength/2, plateWidth/2, -plateLength/2)
    Set rectangle = factory2D.CreateLine(plateWidth/2, -plateLength/2, plateWidth/2, plateLength/2)
    Set rectangle = factory2D.CreateLine(plateWidth/2, plateLength/2, -plateWidth/2, plateLength/2)
    Set rectangle = factory2D.CreateLine(-plateWidth/2, plateLength/2, -plateWidth/2, -plateLength/2)
    
    ' Create 16 holes in a 4x4 grid
    Dim rowSpacing As Double: rowSpacing = plateLength / 5  ' Space between rows
    Dim colSpacing As Double: colSpacing = plateWidth / 5   ' Space between columns
    Dim holeRadius As Double: holeRadius = 6  ' 12mm diameter holes
    
    Dim circles(15) As Circle2D
    Dim i As Integer, j As Integer, index As Integer
    
    index = 0
    For i = 1 To 4
        For j = 1 To 4
            Dim x As Double: x = -plateWidth/2 + j * colSpacing
            Dim y As Double: y = -plateLength/2 + i * rowSpacing
            Set circles(index) = factory2D.CreateCircle(x, y, holeRadius)
            index = index + 1
        Next j
    Next i
    
    ' Close sketch edition
    basePlateSketch.CloseEdition
    
    ' Extrude the base plate
    Dim pad As Pad
    Set pad = part.ShapeFactory.AddNewPad(basePlateSketch, 12.7)  ' 0.5 inch = 12.7mm
    pad.Name = "Base Plate"
    
    ' Update the part
    part.Update
    
    ' Save the document
    partDocument.SaveAs "ReferenceStandard_16Holes.CATPart"
    
    ' Display confirmation
    MsgBox "Reference standard with 16 holes created successfully."
End Sub